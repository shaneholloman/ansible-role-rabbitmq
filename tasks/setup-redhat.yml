---
- name: Ensure erlang is installed.
  ansible.builtin.package:
    name: erlang
    state: present

- name: Add GPG keys.
  ansible.builtin.rpm_key:
    key: "{{ item }}"
    state: present
  with_items:
    - "https://packagecloud.io/gpg.key"
    - "https://packagecloud.io/rabbitmq/erlang/gpgkey"
    - "https://packagecloud.io/rabbitmq/rabbitmq-server/gpgkey"
    - "https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc"

- name: Download RabbitMQ package.
  ansible.builtin.get_url:
    url: "{{ rabbitmq_rpm_url }}"
    dest: "/tmp/{{ rabbitmq_rpm }}"
    mode: '0644'

- name: Ensure RabbitMQ is installed.
  ansible.builtin.yum:
    name: "/tmp/{{ rabbitmq_rpm }}"
    state: "present"
